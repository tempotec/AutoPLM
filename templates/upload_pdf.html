{% extends "base.html" %}

{% block title %}Upload PDF - Fichas Técnicas{% endblock %}

{% block content %}
<div class="row mt-4">
    <div class="col-12">
        <h2><i class="fas fa-upload me-2"></i>Upload de Ficha Técnica</h2>
        <hr>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-body">
                <form method="POST" enctype="multipart/form-data">
                    {{ form.hidden_tag() }}
                    
                    <div class="upload-area mb-4">
                        <i class="fas fa-file-upload fa-3x text-muted mb-3"></i>
                        <h5>Selecione sua ficha técnica em PDF</h5>
                        <p class="text-muted">Arraste e solte o arquivo aqui ou clique para selecionar</p>
                        {{ form.pdf_file(class="form-control", style="display: none;", id="pdf-input") }}
                        <button type="button" class="btn btn-outline-primary" onclick="document.getElementById('pdf-input').click()">
                            <i class="fas fa-folder-open me-1"></i>Escolher Arquivo
                        </button>
                        
                        {% if form.pdf_file.errors %}
                            <div class="text-danger mt-2">
                                {% for error in form.pdf_file.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div id="file-info" class="alert alert-info" style="display: none;">
                        <i class="fas fa-file-pdf text-danger me-2"></i>
                        <span id="file-name"></span>
                    </div>
                    
                    <div class="alert alert-warning">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Processamento Automático:</strong> Após o upload, o sistema irá extrair automaticamente as seguintes informações:
                        <ul class="mb-0 mt-2">
                            <li>Identificação da Peça (REF, Descrição, Coleção, etc.)</li>
                            <li>Informações Comerciais (Preço, Cronograma)</li>
                            <li>Prazos e Entregas</li>
                            <li>Equipe Envolvida</li>
                            <li>Matéria-Prima e Aviamentos</li>
                            <li>Especificações Técnicas de Modelagem</li>
                            <li>Design e Estilo</li>
                        </ul>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-1"></i>Voltar
                        </a>
                        {{ form.submit(class="btn btn-primary") }}
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('pdf-input').addEventListener('change', function(e) {
    const fileInfo = document.getElementById('file-info');
    const fileName = document.getElementById('file-name');
    
    if (e.target.files.length > 0) {
        fileName.textContent = e.target.files[0].name;
        fileInfo.style.display = 'block';
    } else {
        fileInfo.style.display = 'none';
    }
});

// Drag and drop functionality
const uploadArea = document.querySelector('.upload-area');
const fileInput = document.getElementById('pdf-input');

uploadArea.addEventListener('dragover', function(e) {
    e.preventDefault();
    uploadArea.style.borderColor = '#007bff';
    uploadArea.style.backgroundColor = '#f8f9ff';
});

uploadArea.addEventListener('dragleave', function(e) {
    e.preventDefault();
    uploadArea.style.borderColor = '#ccc';
    uploadArea.style.backgroundColor = '#f8f9fa';
});

uploadArea.addEventListener('drop', function(e) {
    e.preventDefault();
    uploadArea.style.borderColor = '#ccc';
    uploadArea.style.backgroundColor = '#f8f9fa';
    
    const files = e.dataTransfer.files;
    if (files.length > 0 && files[0].type === 'application/pdf') {
        fileInput.files = files;
        document.getElementById('file-name').textContent = files[0].name;
        document.getElementById('file-info').style.display = 'block';
    }
});
</script>
{% endblock %}